<!DOCTYPE HTML>
<html>
    <head>
        <script type="text/javascript">
            function init()
            {
                var game = {};
                var playerName = document.getElementById("name").value.trim();
                if (!playerName) {
                    alert("Please enter a name"); return;
                }

                document.getElementById("splash").style.display = "none";
                document.getElementById("game").style.display = "block";
                var ws = new WebSocket("ws://localhost:8080/websocket");

                ws.onopen = function()
                {
                    // Give window responsability for pinging the server to keep the connection alive
                    window.setInterval(function() { ws.send("ping") }, 1000)
                    ws.send("ready");
                };

                ws.onmessage = function (evt)
                {
                    data = JSON.parse(evt.data)
                    console.log(data)

                    switch(data.Type) {
                        case "SET":
                            game = data.Game
                            prepareGame(data.Game)
                            ws.send("start")
                            break;
                        case "UPDATE":
                            game = data.Game
                            renderBall(game.Ball);
                            break;
                    }
                };

                ws.onclose = function()
                {
                    console.log("Closed");
                };
            }

            function prepareGame(data) {
                var board = document.getElementById("board");
                board.style.width = data.Width + "px";
                board.style.height = data.Height + "px";
                renderBall(data.Ball)
            }
            
            function renderBall(ballData) {
                document.getElementById("ball").style.left = ballData.Pos.Left + "px";
                document.getElementById("ball").style.top = ballData.Pos.Top + "px";
            }
        </script>
    </head>

    <body id="board" style="position: relative; background-color: black;">
        <div id="splash" >
            <input id="name" type="text" style="display:block;" />
            <button onclick="javascript:init()">Start Playing!</button>
        </div>
        <div id="game" style="display: none;position: relative; height: 100%;">
            <div id="paddle1" style="background-color: white;display: inline-block; width:10px; height: 60px; position: absolute; left: 20px; top: 10px;"></div>
            <div id="paddle2" style="background-color: white;display: inline-block; width:10px; height: 60px; position:absolute; right: 20px; top: 10px;"></div>
            <div id="ball" style="position: absolute; width:10px; height: 10px; background-color:white; top: 145px; left: 145px;"></div>
        </div>
    </body>
</html>

